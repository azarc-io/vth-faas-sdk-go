syntax = "proto3";
package sdk_v1;
option go_package = "github.com/azarc-io/vth-faas-sdk-go/pkg/api/v1;sdk_v1";

message Void {}

/************************************************************************/
/* ENUMS
/************************************************************************/

enum StageStatus {
  StagePending = 0;
  StageStarted = 1;
  StageCompleted = 2;
  StageFailed = 3;
  StageSkipped = 4;
  StageCanceled = 5;
}

enum JobStatus {
  JobWaiting = 0;
  JobRunning = 1;
  JobCompletionRunning = 2;
  JobCompleted = 3;
  JobCompletedWithErrors = 4;
  JobCompensating = 5;
  JobCompensationCompleted = 6;
  JobCompensationCompletedWithErrors = 7;
  JobCanceling = 8;
  JobCancellationCompleted = 9;
  JobCancellationCompletedWithErrors = 10;
}

/************************************************************************/
/* JOB
/************************************************************************/
message Job {
  string correlation_id = 1;
  string key = 2;
  string transaction_id = 3;
  JobStatus status = 4;
  string reason = 5;
}

message GetJobRequest {
  string key = 1;
}

message GetJobResponse {
  Job job = 1;
}

message SetJobStatusRequest {
  string job_key = 1;
  JobStatus status = 2;
  string reason = 3;
}

/************************************************************************/
/* STAGE
/************************************************************************/

message Stage {
  Job job = 1;
  string name = 2;
  StageStatus status = 3;
  string reason = 4;
  bool retry = 5;
}

message StageResult {
  Stage stage = 1;
  bytes data = 2;
}

message GetStageStatusRequest {
  string name = 1;
  string job_id = 2;
}

message GetStageStatusResponse {
  Stage stage = 1;
}

message SetStageStatusRequest {
  Stage stage = 1;
}

message GetStageResultRequest {
  string name = 1;
  string job_id = 2;
}

message GetStageResultResponse {
  Stage stage = 1;
  StageResult result = 2;
}

message SetStageResultRequest {
  Stage stage = 1;
  StageResult result = 2;
}

/************************************************************************/
/* VARIABLE
/************************************************************************/

message Variable {
  string name = 1;
  bytes value = 2;
  string mime_type = 3;
}

message GetVariableRequest {
  string name = 1;
  string stage = 2;
  string job_id = 3;
}

message GetVariableResponse {
  Variable variable = 1;
}

message SetVariableRequest {
  string name = 1;
  string stage = 2;
  string job_id = 3;
  Variable variable = 4;
}

service Service {
  rpc GetStageStatus(GetStageStatusRequest) returns (GetStageStatusResponse);
  rpc SetStageStatus(SetStageStatusRequest) returns (Void);
  rpc GetStageResult(GetStageResultRequest) returns (GetStageStatusResponse);
  rpc SetStageResult(SetStageResultRequest) returns (Void);
  rpc GetVariable(GetVariableRequest) returns (GetVariableResponse);
  rpc SetVariable(SetVariableRequest) returns (Void);
  rpc GetJob(GetJobRequest) returns (GetJobResponse);
  rpc SetJobStatus(SetJobStatusRequest) returns (Void);
}
